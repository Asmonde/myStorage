<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Modules</ui:define>

    <ui:define name="content">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12 ui-lg-12">
                <div class="card card-w-title">
                    <p:fieldset styleClass="fiedlset" legend="Gestion des Modules" rendered="#{fonctionnaliteBean.visible}">
                        <p:tabView styleClass="tabview" id="tabview" rendered="#{loginBean.moduleFonctionnalite}">
                            <p:tab title="Fonctionnalités" rendered="#{loginBean.consulterFonctionnalite}">
                                <h:form id="userForm" styleClass="userForm">
                                    <p:panel styleClass="FonctionnalitePanel" id="FonctionnalitePanel" header="Formulaire de fonctionnalité" style="border-color: #171b1f;"> 
                                        <p:growl id="message" life="4000" showSummary="true"/>
                                        <p:panelGrid columnClasses="ui-grid-col-7,ui-grid-col-5" columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                            <p:panelGrid columnClasses="ui-grid-col-12" columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                                <p:dataTable paginatorAlwaysVisible="false" var="fonctionnalite" id="fonctionnaliteTab" widgetVar="fonctionnaliteTable" value="#{fonctionnaliteBean.fonctionnalites}"
                                                             emptyMessage="fonctionnalité non trouvé" reflow="true" globalFilterFunction="#{fonctionnaliteBean.globalFilterFunction}"
                                                             style="border-color: #00AEEF" filteredValue="#{fonctionnaliteBean.fonctionnalitesFilter}" 
                                                             rows="5" scrollable="true"  paginator="true" paginatorPosition="top" 
                                                             rowsPerPageTemplate="2,5,10,15" sortBy="#{fonctionnalite.id}">
                                                    <f:facet name="header">
                                                        <p:outputPanel>
                                                            <h:outputText value="Rechercher toutes les valeurs :" />
                                                            <p:inputText id="globalFilter" onkeyup="PF('fonctionnaliteTable').filter()" style="width:150px" placeholder="entrer la valeur"/>
                                                        </p:outputPanel>
                                                    </f:facet>
                                                    <p:column sortBy="#{fonctionnalite.libelle}" filterMatchMode="startsWith" id="libFonctionnalite"  headerText="Libellé">
                                                        <h:outputText value="#{fonctionnalite.libelle}" />
                                                    </p:column>
                                                    <p:column  id="descFonctionnalite" headerText="Description"  sortBy="#{fonctionnalite.description}" filterMatchMode="startsWith">
                                                        <h:outputText value="#{fonctionnalite.description}" />
                                                    </p:column>
                                                    <p:column width="10%" rendered="#{loginBean.modifierFonctionnalite}">
                                                        <p:commandButton update="@(.FonctionnalitePanel)" icon="fa fa-fw fa-edit" title="Editer" actionListener="#{fonctionnaliteBean.getObjectFonctionnalite(fonctionnalite.id)}" process="@this">
                                                            <f:setPropertyActionListener value="#{fonctionnalite}" target="#{fonctionnaliteBean.fonctionnalite}" />
                                                        </p:commandButton>
                                                    </p:column>
                                                </p:dataTable>
                                            </p:panelGrid>
                                            <p:panelGrid columnClasses="ui-grid-col-12" columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                                <p:panelGrid columnClasses="ui-grid-col-12" columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                                    <p:outputPanel>
                                                        <p:outputLabel style="color: #457fca;font-weight: bold" class="ui-inputgroup-addon ui-md-2" for="libFonct" value="Libelle :"/>
                                                        <p:inputText requiredMessage="Saisir le libellé de la fonctionnalité" id="libFonct" value="#{fonctionnaliteBean.fonctionnalite.libelle}" required="true" placeholder="Libellé"/>
                                                    </p:outputPanel>
                                                    <p:outputPanel>
                                                        <p:outputLabel style="color: #457fca;font-weight: bold" class="ui-inputgroup-addon ui-md-2" for="descFonc" value="Description :"/>
                                                        <p:inputText id="descFonc" requiredMessage="Saisir la description de la fonctionnalité" value="#{fonctionnaliteBean.fonctionnalite.description}" required="true" placeholder="Description"/>
                                                    </p:outputPanel>
                                                </p:panelGrid>
                                                <p:panelGrid columnClasses="ui-grid-col-3,ui-grid-col-3,ui-grid-col-3,ui-grid-col-3" columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                                    <h:inputHidden/>
                                                    <p:commandButton update="@(.FonctionnalitePanel)" process="@this" action="#{fonctionnaliteBean.cancel()}" value="Annuler" icon="fa fa-ban"></p:commandButton>
                                                    <p:commandButton update="@(.FonctionnalitePanel,.moduleFonctionnalitePanel)" rendered="#{loginBean.ajouterFonctionnalite}" process="@form" action ="#{fonctionnaliteBean.save()}" value="Valider" icon="fa fa-save">
                                                        <p:confirm header="Confirmation" message="#{loginBean.message()}" icon="ui-icon-danger"/>  
                                                    </p:commandButton>
                                                    <h:inputHidden/>
                                                </p:panelGrid>
                                            </p:panelGrid>
                                        </p:panelGrid>
                                    </p:panel>
                                </h:form>
                            </p:tab>
                            <p:tab title="Affectation des modules" rendered="#{loginBean.consulterFModule}">
                                <h:form id="userForm1" styleClass="userForm">
                                    <p:panel styleClass="moduleFonctionnalitePanel" id="profilPanel" header="Formulaire de module" style="border-color: #171b1f;"> 
                                        <p:growl id="message1" life="4000" showSummary="true"/>
                                        <p:panelGrid columnClasses="ui-grid-col-7,ui-grid-col-5" columns="2" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                            <p:panelGrid columnClasses="ui-grid-col-12" columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group">
                                                <p:dataTable paginatorAlwaysVisible="false" var="foncM1" id="modulesTab" widgetVar="ModulesTable1" value="#{fonctionnaliteBean.fonctionnaliteModules}"
                                                             emptyMessage="Fonctionnalité non trouvée" reflow="true" globalFilterFunction="#{fonctionnaliteBean.globalFilterFunction1}"
                                                             style="border-color: #00AEEF" filteredValue="#{fonctionnaliteBean.fonctionnaliteModulesFilter}" 
                                                             rows="5" scrollable="true"  paginator="true" paginatorPosition="top" 
                                                             rowsPerPageTemplate="2,5,10,15" sortBy="#{foncM1.id}">
                                                    <f:facet name="header">
                                                        <p:outputPanel>
                                                            <h:outputText value="Rechercher toutes les valeurs :" />
                                                            <p:inputText id="globalFilter" onkeyup="PF('ModulesTable1').filter()" style="width:150px" placeholder="entrer la valeur"/>
                                                        </p:outputPanel>
                                                    </f:facet>
                                                    <p:column sortBy="#{foncM1.modules.libelle}" groupRow="true" filterMatchMode="startsWith" headerText="Module">
                                                        <h:outputText value="#{foncM1.modules.libelle}" />
                                                    </p:column>
                                                    <p:column  headerText="Libellé"  sortBy="#{foncM1.fonctionnalite.libelle}" filterMatchMode="startsWith">
                                                        <h:outputText value="#{foncM1.fonctionnalite.libelle}" />
                                                    </p:column>
                                                    <p:column width="10%" rendered="#{loginBean.desactiverFModule}">
                                                        <p:commandButton rendered="#{loginBean.desactiverFModule}" update="@(.moduleFonctionnalitePanel)" process="@this" icon="fa fa-unlock" title="Désactiver" actionListener="#{fonctionnaliteBean.unluckFonc(foncM1.id)}">
                                                            <p:confirm header="Confirmation" message="#{loginBean.message()}" icon="ui-icon-danger"/>  
                                                            <p:ajax event="click" listener="#{fonctionnaliteBean.fonctionnaliteNonModules()}" update="@(.fiedlset)"/>
                                                        </p:commandButton>                                   
                                                    </p:column>
                                                </p:dataTable>
                                            </p:panelGrid>
                                            <p:panelGrid columnClasses="ui-grid-col-12" columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                                <p:panelGrid columnClasses="ui-grid-col-12" columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                                    <p:outputPanel>
                                                        <p:outputLabel style="color: #457fca;font-weight: bold" class="ui-inputgroup-addon ui-md-2" for="module" value="Module :"/>
                                                        <p:selectOneMenu  id="module" value="#{fonctionnaliteBean.modules}" effect="fade"
                                                                          filter="true" required="true" requiredMessage="séléctionner le module" filterMatchMode="startsWith"
                                                                          converter="omnifaces.SelectItemsIndexConverter">
                                                            <f:selectItem itemLabel="Choisir le module" noSelectionOption="true"/>
                                                            <f:selectItems value="#{fonctionnaliteBean.moduleses}" var="modu" itemLabel="#{modu.libelle}" itemValue="#{modu}"/>

                                                        </p:selectOneMenu> 
                                                    </p:outputPanel>
                                                    <p:outputPanel>
                                                        <p:outputLabel style="color: #457fca;font-weight: bold" class="ui-inputgroup-addon ui-md-2" for="fonct" value="Fonctionnalité :"/>
                                                        <p:selectCheckboxMenu multiple="true" dynamic="true" updateLabel="true" immediate="true" id="fonct" value="#{fonctionnaliteBean.fonctionnalites1}" panelStyleClass="without-selectall"
                                                                              converter="omnifaces.SelectItemsIndexConverter"  
                                                                              label="Fonctionnalités" filter="true" filterMatchMode="contains" required="true" requiredMessage="Selectionner l'(es) utilisateur(s)">
                                                            <f:selectItems value="#{fonctionnaliteBean.fonctionnaliteNonModules()}" itemLabel="#{fonc.libelle}" itemValue="#{fonc}" var="fonc"/>
                                                        </p:selectCheckboxMenu> 
                                                    </p:outputPanel>
                                                </p:panelGrid>
                                                <p:panelGrid columnClasses="ui-grid-col-3,ui-grid-col-3,ui-grid-col-3,ui-grid-col-3" columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group"> 
                                                    <h:inputHidden/>
                                                    <p:commandButton update="@(.moduleFonctionnalitePanel)" process="@this" action="#{fonctionnaliteBean.cancel()}" value="Annuler" icon="fa fa-ban"></p:commandButton>
                                                    <p:commandButton update="@(.moduleFonctionnalitePanel)" rendered="#{loginBean.associerFModule}" class="Fs16 GreenButton" id="ajouter1" value="Associer" title="Associer" icon="fa fa-save" actionListener="#{fonctionnaliteBean.associerModule()}" process="@form">
                                                        <p:confirm header="Confirmation" message="Veuillez bien vérifier les informations saisies avant d'enégisiter. Voulez-vous vraiment enrégister?" icon="ui-icon-danger"/>  
                                                    </p:commandButton>
                                                    <h:inputHidden/>
                                                </p:panelGrid>
                                            </p:panelGrid>
                                        </p:panelGrid>
                                    </p:panel>
                                </h:form>
                            </p:tab>
                        </p:tabView>
                    </p:fieldset>
                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>
